import random
from datetime import datetime
from services.pig_service import check_level_up
from models.pig import Pig

QUESTS = [
    {
        "title": "–†–æ–∑–≥—Ä—ñ–± —Å–º—ñ—Ç–Ω–∏–∫ üóëÔ∏è",
        "description": "–¢–≤—ñ–π —Ö—Ä—è–∫ –∑–Ω–∞–π—à–æ–≤ —â–æ—Å—å —Å–º–∞—á–Ω–µ!",
        "effects": {"xp": 15, "gold": 5}
    },
    {
        "title": "–ü–µ—Ä–µ–≥–æ–Ω–∏ –∑ –∫–∞–±–∞–Ω–∞–º–∏ üêó",
        "description": "–®–≤–∏–¥–∫—ñ—Å—Ç—å ‚Äî —Ü–µ —Å–∏–ª–∞!",
        "effects": {"xp": 20}
    },
    {
        "title": "–•—Ä—è–∫-–¥–µ—Ç–µ–∫—Ç–∏–≤ üïµÔ∏è",
        "description": "–•—Ç–æ –≤–∫—Ä–∞–≤ –º–æ—Ä–∫–≤—É?..",
        "effects": {"xp": 10, "strength": 1}
    },
    {
        "title": "–î–µ–Ω—å —Å–Ω—É üò¥",
        "description": "–í—ñ–¥–ø–æ—á–∏–Ω–æ–∫ ‚Äî –Ω–∞–π–∫—Ä–∞—â–∏–π —Ç—Ä–µ–Ω—ñ–Ω–≥.",
        "effects": {"health": 5}
    },
    {
        "title": "–†–æ–∑–º–æ–≤–∞ –∑ —à–∞–º–∞–Ω–æ–º üêóüîÆ",
        "description": "–®–∞–º–∞–Ω –ø–µ—Ä–µ–¥—Ä—ñ–∫ –Ω–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å!",
        "effects": {"level": 1}
    },
    # –ù–æ–≤—ñ –∫–≤–µ—Å—Ç–∏
    {
        "title": "–ú–∏—Å–ª–∏–≤—Å—å–∫–∏–π –¥–µ–Ω—å ü¶å",
        "description": "–¢–≤—ñ–π —Ö—Ä—è–∫ –ø–æ–ø–∞–≤ –Ω–∞ –ø–æ–ª—é–≤–∞–Ω–Ω—è —ñ –ø—Ä–∏–Ω–µ—Å–ª–æ –±–∞–≥–∞—Ç–æ –º'—è—Å–∞!",
        "effects": {"strength": 2, "gold": 10}
    },
    {
        "title": "–ú–∞–≥—ñ—á–Ω–∞ —Ç—Ä–∞–≤–∞ üå±",
        "description": "–ó–Ω–∞–π—à–æ–≤ –º–∞–≥—ñ—á–Ω—É —Ç—Ä–∞–≤—É, —è–∫–∞ –¥–∞—î –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Å–∏–ª–∏!",
        "effects": {"xp": 25, "health": 10}
    },
    {
        "title": "–°–ø–æ—Ä—Ç–∏–≤–Ω–∏–π —Ç—É—Ä–Ω—ñ—Ä üèÜ",
        "description": "–¢–∏ —Å—Ç–∞–≤ –ø–µ—Ä–µ–º–æ–∂—Ü–µ–º —Ç—É—Ä–Ω—ñ—Ä—É —Å–µ—Ä–µ–¥ —Å–≤–∏–Ω–µ–π!",
        "effects": {"xp": 30, "strength": 3}
    },
    {
        "title": "–¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è —É –ª—ñ—Å—ñ üå≤",
        "description": "–¢–≤—ñ–π —Ö—Ä—è–∫ –∑–∞–π–Ω—è–≤—Å—è —Ñ—ñ–∑–∏—á–Ω–∏–º–∏ –≤–ø—Ä–∞–≤–∞–º–∏ –≤ –ª—ñ—Å—ñ.",
        "effects": {"strength": 4, "health": 3}
    },
    {
        "title": "–í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Å–∫–∞—Ä–±—É üíé",
        "description": "–¢–≤—ñ–π —Ö—Ä—è–∫ –∑–Ω–∞–π—à–æ–≤ —Å–∫–∞—Ä–± —ñ–∑ –∑–æ–ª–æ—Ç–∏–º–∏ –º–æ–Ω–µ—Ç–∞–º–∏ —Ç–∞ –º–∞–≥—ñ—á–Ω–∏–º–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏.",
        "effects": {"gold": 20, "xp": 40}
    }
]

def apply_quest(pig: Pig):
    quest = random.choice(QUESTS)
    for key, value in quest["effects"].items():
        setattr(pig, key, getattr(pig, key) + value)
    
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ check_level_up —ñ –æ—Ç—Ä–∏–º—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    level_ups, rank_msg = check_level_up(pig)

    # –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —á–∞—Å—É –∫–≤–µ—Å—Ç—É
    pig.last_quest_time = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    
    return quest, level_ups, rank_msg  # –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –≤–∫–ª—é—á–∞—é—á–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
